INSTALACIÓN DE LIBRERÍAS Y REPOSITORIOS
===========================================================
===========================================================

Powertools
sudo dnf config-manager --set-enabled powertools (RHEL8)
sudo dnf config-manager --set-enabled crb (RHEL9)

sudo nano /etc/ld.so.conf.d/local.conf  
/usr/local/lib 
/usr/local/lib64 

# Instalar todas las dependencias disponibles
sudo dnf install -y gcc flex bison zlib zlib-devel libpcap libpcap-devel \
pcre pcre-devel tcpdump openssl openssl-devel \
hwloc hwloc-devel cmake cmake3 git wget make autoconf automake \
libtool libnet libnet-devel libyaml libyaml-devel file-devel \
doxygen rpm-build libmnl libmnl-devel nano which

sudo dnf groupinstall -y "Development Tools"
sudo dnf groupinstall -y "Development Libraries"

libdnet
cd /tmp
wget https://github.com/ofalk/libdnet/archive/refs/tags/libdnet-1.16.tar.gz
tar -xvzf libdnet-1.16.tar.gz
cd libdnet-libdnet-1.16
./configure --prefix=/usr
make
sudo make install

#Comando usado por el profesor (Verificación de si están todos los paquetes)
sudo dnf install flex bison gcc gcc-c++ make cmake autoconf libtool git nano unzip wget libpcap-devel pcre-devel libdnet-devel hwloc-devel openssl-devel zlib-devel luajit-devel pkgconfig pkgconf libunwind-devel libnfnetlink-devel libnetfilter_queue-devel libmnl-devel xz-devel gperftools libuuid-devel hyperscan hyperscan-devel  -y


#Libdaq
git clone https://github.com/snort3/libdaq.git 
cd libdaq/ 
./bootstrap 
./configure && make && sudo make install 
sudo ldconfig 
cd ../ 


## instalar snort
=====================================================
=====================================================
git clone https://github.com/snort3/snort3.git 
cd snort3 
export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig:$PKG_CONFIG_PATH 
export PKG_CONFIG_PATH=/usr/local/lib64/pkgconfig:$PKG_CONFIG_PATH 
export CFLAGS="-O3" 
export CXXFLAGS="-O3 -fno-rtti" 
./configure_cmake.sh --prefix=/usr/local/snort --enable-tcmalloc 

cd build/ 
make -j$(nproc) 
sudo make -j$(nproc) install 
cd ../../ 
sudo ldconfig 
/usr/local/snort/bin/snort
sudo ln -s /usr/local/snort/bin/snort /usr/bin/snort
snort -V

Si no funciona el snort -V significa que hay un error en el path del sistema 

# Verificar si snort está instalado
ls -la /usr/local/snort/bin/snort

# Verificar el enlace simbólico
ls -la /usr/bin/snort

# Verificar el PATH
echo $PATH

# Opción 1: Crear el enlace simbólico correctamente
sudo ln -sf /usr/local/snort/bin/snort /usr/local/bin/snort

# Opción 2: Agregar al PATH del sistema
echo 'export PATH=/usr/local/snort/bin:$PATH' | sudo tee -a /etc/profile.d/snort.sh
source /etc/profile.d/snort.sh

# Opción 3: También crear enlace en /usr/bin 
sudo ln -sf /usr/local/snort/bin/snort /usr/bin/snort

Verificar
snort -V



Configuración de SNORT
===========================================================================
===========================================================================

sudo nano /usr/local/snort/etc/snort/snort.lua
       HOME_NET = '10.0.0.24/24' [TU IP Y MÁSCARA]

Comando de prueba para ver si la configuración es correcta
snort -T -c /usr/local/snort/etc/snort/snort.lua


Poner el adaptador de red en modo promiscuo
sudo ip link set dev ens160 promisc on



#REGLAS#
sudo nano /usr/local/snort/etc/snort/local.rules

ICMP
alert icmp any any -> any any ( msg:"ICMP Traffic Detected"; sid:10000001; metadata:policy security-ips alert; )

HTTP:80
alert tcp any any -> any 80 (msg:"HTTP Traffic Detected"; flow:to_server; sid:1000002; rev:1;)

SSH:22
alert tcp any any -> any 22 (msg:"SSH Traffic Detected"; flow:to_server; sid:1000003; rev:1;)

HTTP:8080
alert tcp any any -> any 8080 (msg:"HTTP Alternative Port Traffic"; flow:to_server; sid:1000004; rev:1;)

FTP:21
alert tcp any any -> any 21 (msg:"FTP Traffic Detected"; flow:to_server; sid:1000005; rev:1;)


EJECUCIÓN:
sudo snort -c /usr/local/snort/etc/snort/snort.lua -R /usr/local/snort/etc/snort/local.rules -i ens160 -A alert_fast -s 65535 -k none
